YUI().use("aui-base","aui-popover","event-outside","event-tap",function(e){var t=e.Lang,a=["SPAN"],n=[13,32,37,38,39,40],o=e.UA.mobile,i='<svg xmlns="http://www.w3.org/2000/svg" height="20" style="display: none;" version="1.1" width="20"><path d="M0.5 4 L10 11.3 L19.5 4 L0.5 4 zM0 5.5 L0 15.2 L6.4 10.4 L0 5.5 zM20 5.5 L13.6 10.4 L20 15.3 L20 5.5 zM7.6 11.3 L1.5 16 L18.5 16 L12.4 11.3 L10.2 13 L10 13.2 L9.8 13 L7.6 11.3 z" id="emailIconTemplate"/></svg>',r='<svg xmlns="http://www.w3.org/2000/svg" height="20" style="display: none;" version="1.1" width="20"><path d="M5.5 -0 C4.7 -0 4 0.7 4 1.5 l0 17C4 19.3 4.7 20 5.5 20 l9 0c0.8 0 1.5 -0.7 1.5 -1.5l0 -17C16 0.7 15.3 -0 14.5 -0 l-9 0zm2.8 0.7 3.5 0c0.2 0 0.3 0.1 0.3 0.3l0 0c0 0.2 -0.1 0.3 -0.3 0.3l-3.5 0C8.1 1.3 7.9 1.2 7.9 1 l0 -0C7.9 0.8 8.1 0.7 8.2 0.7 zM5 2.1 l10 0 0 15.3 -10 0L5 2.1 zM6.4 5.5 C6.1 5.5 5.8 5.8 5.8 6.1 l0 5.6c0 0.1 0 0.3 0 0.4 -0.1 0.8 -0.6 1.2 -0.6 1.2 0 0 0.3 -0.1 0.7 -0.2 0.1 0.2 0.3 0.3 0.5 0.3l5.6 0c0.3 0 0.6 -0.3 0.6 -0.6l0 -6.7C12.7 5.8 12.4 5.5 12.1 5.5 l-5.6 0zm1.5 8.5c-0.3 0 -0.6 0.3 -0.6 0.6l0 1.5c0 0.3 0.3 0.6 0.6 0.6l5.6 0c0.2 0 0.4 -0.1 0.5 -0.3 0.4 0.2 0.8 0.3 0.8 0.3 0 0 -0.5 -0.4 -0.6 -1.2l0 -0.8C14.2 14.3 13.9 14 13.5 14 L7.9 14 zM10 17.9 c0.4 0 0.8 0.3 0.8 0.8 0 0.4 -0.3 0.8 -0.8 0.8 -0.4 0 -0.8 -0.3 -0.8 -0.8 0 -0.4 0.3 -0.8 0.8 -0.8z" id="mobileIconTemplate" /></svg>',s='<svg xmlns="http://www.w3.org/2000/svg" height="20" style="display: none;" version="1.1" viewBox="0 0 216 146" width="20" xml:space="preserve"><path d="m 204.2 94 c 1.5 -7.2 2.2 -14.2 2.2 -21 0 -13.3 -2.6 -26.1 -7.8 -38.3 C 193.5 22.6 186.5 12.1 177.7 3.3 168.9 -5.5 158.4 -12.5 146.2 -17.7 c -12.2 -5.2 -24.9 -7.8 -38.3 -7.8 -6.8 0 -13.8 0.7 -21 2.2 -9.7 -7.5 -20.6 -11.2 -32.7 -11.2 -14.8 0 -27.5 5.2 -38 15.7 C 5.8 -8.2 0.5 4.5 0.5 19.3 c 0 12.1 3.7 23 11.2 32.7 -1.5 7.2 -2.2 14.2 -2.2 21 0 13.3 2.6 26.1 7.8 38.3 5.2 12.2 12.2 22.7 21 31.5 8.8 8.8 19.3 15.8 31.5 21 12.2 5.2 24.9 7.8 38.3 7.8 6.8 0 13.8 -0.7 21 -2.2 9.7 7.5 20.6 11.2 32.7 11.2 14.8 0 27.5 -5.2 38 -15.7 10.5 -10.5 15.7 -23.1 15.7 -38 -0 -12.1 -3.7 -23 -11.2 -32.7 z m -44.2 20.8 c -3.1 5.5 -7.2 9.8 -12.4 13.1 -5.2 3.3 -10.9 5.8 -17.1 7.5 -6.2 1.7 -12.8 2.6 -19.6 2.6 -15.8 0 -29.3 -3.1 -40.7 -9.2 -11.4 -6.1 -17.1 -13.4 -17.1 -22 0 -4.2 1.2 -7.7 3.6 -10.5 2.4 -2.8 5.9 -4.2 10.6 -4.2 2.7 0 5.2 0.7 7.6 2.2 2.3 1.5 4.5 3.3 6.4 5.4 2 2.1 4.1 4.2 6.4 6.3 2.3 2.1 5.3 3.9 9.1 5.4 3.8 1.5 8 2.2 12.8 2.2 6.1 0 11 -1.2 14.7 -3.6 3.7 -2.4 5.6 -5.4 5.6 -9 0 -3.7 -1.5 -6.5 -4.5 -8.4 -2 -1.3 -7.3 -3 -15.7 -5 L 89.2 82.6 C 83.6 81.2 78.8 79.7 74.8 78 70.8 76.3 67.1 74 63.6 71.2 c -3.4 -2.8 -6.1 -6.3 -7.8 -10.6 -1.8 -4.2 -2.7 -9.2 -2.7 -14.9 0 -6.8 1.6 -12.8 4.7 -18 3.1 -5.2 7.3 -9.2 12.4 -12.2 5.2 -2.9 10.7 -5.1 16.7 -6.6 6 -1.4 12.1 -2.2 18.5 -2.2 9 0 17.4 1.1 25.5 3.2 8 2.1 14.6 5.3 19.9 9.4 5.2 4.2 7.8 8.8 7.8 13.9 0 4.2 -1.3 7.8 -4 10.8 -2.7 3 -6.2 4.5 -10.6 4.5 -2.4 0 -4.7 -0.6 -6.7 -1.7 -2.1 -1.1 -3.9 -2.5 -5.6 -4.1 -1.7 -1.6 -3.5 -3.1 -5.3 -4.7 -1.9 -1.5 -4.4 -2.9 -7.5 -4 -3.2 -1.1 -6.8 -1.7 -10.8 -1.7 -13.4 0 -20.1 3.6 -20.1 10.8 0 1.6 0.4 3 1 4.2 0.7 1.2 1.5 2.2 2.3 2.9 0.8 0.7 2.2 1.5 4.2 2.2 2 0.7 3.6 1.3 4.9 1.6 1.3 0.3 3.4 0.8 6.2 1.5 l 14.5 3.4 c 4.6 1 8.6 2.1 12.2 3.2 3.6 1.1 7.4 2.7 11.5 4.8 4.1 2.1 7.5 4.3 10.2 6.9 2.7 2.5 5 5.7 6.8 9.6 1.8 3.9 2.7 8.1 2.7 12.8 -0 6.8 -1.5 12.9 -4.6 18.4 z" id="skypeIconTemplate" /></svg>',p='<svg height="20" style="fill:#AAA; vertical-align: bottom;" width="20"><use xlink:href="#emailIconTemplate"></svg>',l='<svg height="20" style="fill:#00AFFF; vertical-align: bottom;" viewBox="0 0 216 146" width="20"><use xlink:href="#skypeIconTemplate"></svg>',u='<svg height="20" style="fill:#AAA; vertical-align: bottom;" width="20"><use xlink:href="#mobileIconTemplate"></svg>',c='<a href="{href}" style="display: block; padding: 5px;">{type}</a>',h='<div><div style="border-bottom: 1px solid #DDD; color: #AAA; min-width: 100px; padding-bottom: 3px;">{icon} {label}:</div>{chatLinks}</div>',d='<a class="{cssClass}" href="javascript:;" id="{id}" data-displayname="{displayName}" data-chatemail="{email}" data-chatlauncher="{users}" data-chatnumber="{number}" data-chattopic="{topic}">{html}</a>',_=e.Component.create({NAME:"chatlauncher",EXTENDS:e.Base,prototype:{EMAIL_SCHEMA:{groupIcon:p,groupIconTemplate:i,groupLabelFn:"_emailGroupLabelFn",types:["email"],URIFn:"_emailURIFn"},SKYPE_NUMBER_SCHEMA:{groupIcon:l,groupIconTemplate:s,groupLabelFn:"_skypeGroupLabelFn",types:["sms","call"],URIFn:"_skypeURIFn"},SKYPE_SCHEMA:{groupIcon:l,groupIconTemplate:s,groupLabelFn:"_skypeGroupLabelFn",types:["chat","call"],URIFn:"_skypeURIFn"},SMS_SCHEMA:{groupIcon:u,groupIconTemplate:r,groupLabelFn:"_SMSGroupLabelFn",types:["sms"],URIFn:"_SMSURIFn"},initializer:function(){var e=this;e._renderTriggerUI(),e._bindTriggerUI()},_adjustLabelCase:function(e){return e="sms"!==e?e.charAt(0).toUpperCase()+e.slice(1):e.toUpperCase()},_bindPopoverUI:function(e){var t=this;e.get("boundingBox").on("mouseleave",t._hidePopoverTask,t)},_bindTriggerUI:function(){var t=this,a=t._triggers,n=o?"tap":"mouseenter";a&&(a.on(["keyup",n],e.bind(t._syncPopoverHandler,t)),o||a.on("mouseleave",e.bind(t._onLinkMouseLeave,t)))},_clearHideTimeout:function(){var e=this,t=e._hidePopoverTimeout;t&&(t.cancel(),e._hidePopoverTimeout=null)},_emailGroupLabelFn:function(){var e,t=this,a=t._chatLinkData.email;return e=t._hasMultipleParticipants(a)?"Email":a},_emailURIFn:function(){var e=this,t=e._chatLinkData,a=["mailto:"];return a.push(t.email),a.join("")},_getBodyNode:function(){var t=this,a=t._bodyNode;return a||(a=e.one("body"),t._bodyNode=a),a},_getChatLink:function(e){var a=this,n=a._currentSchema,o=a[n.URIFn](e);return t.sub(c,{href:o,type:a._adjustLabelCase(e)})},_getChatLinkData:function(e){var t=this,a={displayName:e.attr("data-displayname"),email:e.attr("data-chatemail"),html:e.html(),number:e.attr("data-chatnumber"),topic:e.attr("data-chattopic"),users:e.attr("data-chatlauncher")};return t._chatLinkData=a,a},_getChatLinkGroup:function(e){var a=this,n=[],o=a._setCurrentSchema(e),i=o.types;a._renderIconTemplate();for(var r=a[o.groupLabelFn](),s=0;s<i.length;s++)n.push(a._getChatLink(i[s]));return t.sub(h,{chatLinks:n.join(""),icon:o.groupIcon,label:r})},_getPopover:function(){var t=this;return popover=t._popover,popover||(popover=new e.Popover({align:{points:[e.WidgetPositionAlign.LC,e.WidgetPositionAlign.RC]},constrain:!0,position:"right",zIndex:1}),o?e.Event.defineOutside("touchend"):t._bindPopoverUI(popover),t._popover=popover),popover},_getPopoverBodyContent:function(e){var t=this,a=[];return e.users&&a.push(t._getChatLinkGroup("skype")),e.number&&(a.push(t._getChatLinkGroup("skypeNumber")),o&&a.push(t._getChatLinkGroup("sms"))),e.email&&a.push(t._getChatLinkGroup("email")),a.join("")},_getPopoverHeaderContent:function(e){return e.displayName||e.html||null},_getSkypeUserData:function(e){var t,a=this,n=a._chatLinkData;return t=e?n.users:n.number},_hasMultipleParticipants:function(e){return e.match(",")},_hidePopover:function(){var e=this;popover=e._getPopover(),e._clearHideTimeout(),popover.get("boundingBox").test(":hover")||popover.hide()},_hidePopoverTask:function(){var t=this;t._hidePopoverTimeout||(t._hidePopoverTimeout=e.later(300,t,t._hidePopover))},_isSkypeUserName:function(){var e=this,t=e._currentClient;return"skype"===t},_onLinkMouseLeave:function(){var e=this;e._hidePopoverTask()},_renderIconTemplate:function(){var e=this,t=e._currentClient,a=e._currentSchema,n=e._iconTemplates||{};"skypeNumber"===t&&(t="skype"),n[t]||(e._getBodyNode().append(a.groupIconTemplate),n[t]=!0,e._iconTemplates=n)},_renderTriggerUI:function(){var a=this,n=e.all("[data-chatemail], [data-chatlauncher], [data-chatnumber]");n.each(function(o,i){if(a._validateTag(o)){var r={cssClass:o.attr("class"),id:o.attr("id")},s=a._getChatLinkData(o),p=e.Node.create(t.sub(d,e.mix(r,s)));o.replace(p),n._nodes[i]=p}}),a._triggers=n},_setCurrentSchema:function(e){var t,a=this;return"email"===e?t=a.EMAIL_SCHEMA:"skype"===e?t=a.SKYPE_SCHEMA:"skypeNumber"===e?t=a.SKYPE_NUMBER_SCHEMA:"sms"===e&&(t=a.SMS_SCHEMA),a._currentClient=e,a._currentSchema=t,t},_setHideHandler:function(e){var t=this;t._hideHandler||(t._hideHandler=e.get("boundingBox").on("touchendoutside",function(e){var a=e.target;a.hasAttribute("data-chatlauncher")||a.ancestor(".popover",!0,"body")||(t._hidePopover(),t._hideHandler.detach(),t._hideHandler=null)}))},_skypeGroupLabelFn:function(){var e,t=this,a=t._isSkypeUserName(),n=t._getSkypeUserData(a);return e=t._hasMultipleParticipants(n)?a?"Usernames":"Phone Numbers":n},_skypeURIFn:function(e){var t,a=this,n=a._chatLinkData,o=n.topic,i=["skype:"],r=a._getSkypeUserData(a._isSkypeUserName());return a._hasMultipleParticipants(r)&&(r=r.replace(/,/g,";"),"false"!=o&&(t=o)),i.push(r+"?"+e),t&&i.push("&topic="+encodeURI(t)),i.join("")},_SMSGroupLabelFn:function(){return"SMS (Native)"},_SMSURIFn:function(){return"sms:"+this._chatLinkData.number},_syncPopover:function(e){var t=this,a=e.currentTarget,n=t._getPopover(),o=a.guid();if(o!=t._activeId){var i=t._getChatLinkData(a);n.setAttrs({"align.node":a,bodyContent:t._getPopoverBodyContent(i),headerContent:t._getPopoverHeaderContent(i)}),t._activeId=o,e.halt()}n.get("rendered")?n.show():n.render(),n.align(),"keyup"===e.type&&n.get("boundingBox").one("a").focus(),t._setHideHandler(n)},_syncPopoverHandler:function(e){var t=this,a=e.keyCode;a&&-1===n.indexOf(a)||(t._clearHideTimeout(),t._syncPopover(e))},_validateTag:function(e){return-1!==a.indexOf(e.get("nodeName"))}}});new _});