YUI().use("aui-base","aui-popover","event-outside","event-tap",function(e){var t=e.Lang,a=["SPAN"],n=e.UA.mobile,r='<img alt="" src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20version%3D%221.1%22%20width%3D%2220%22%20height%3D%2220%22%20viewBox%3D%220%200%20216%20146%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20d%3D%22m%20204.2%2094%20c%201.5%20-7.2%202.2%20-14.2%202.2%20-21%200%20-13.3%20-2.6%20-26.1%20-7.8%20-38.3%20C%20193.5%2022.6%20186.5%2012.1%20177.7%203.3%20168.9%20-5.5%20158.4%20-12.5%20146.2%20-17.7%20c%20-12.2%20-5.2%20-24.9%20-7.8%20-38.3%20-7.8%20-6.8%200%20-13.8%200.7%20-21%202.2%20-9.7%20-7.5%20-20.6%20-11.2%20-32.7%20-11.2%20-14.8%200%20-27.5%205.2%20-38%2015.7%20C%205.8%20-8.2%200.5%204.5%200.5%2019.3%20c%200%2012.1%203.7%2023%2011.2%2032.7%20-1.5%207.2%20-2.2%2014.2%20-2.2%2021%200%2013.3%202.6%2026.1%207.8%2038.3%205.2%2012.2%2012.2%2022.7%2021%2031.5%208.8%208.8%2019.3%2015.8%2031.5%2021%2012.2%205.2%2024.9%207.8%2038.3%207.8%206.8%200%2013.8%20-0.7%2021%20-2.2%209.7%207.5%2020.6%2011.2%2032.7%2011.2%2014.8%200%2027.5%20-5.2%2038%20-15.7%2010.5%20-10.5%2015.7%20-23.1%2015.7%20-38%20-0%20-12.1%20-3.7%20-23%20-11.2%20-32.7%20z%20m%20-44.2%2020.8%20c%20-3.1%205.5%20-7.2%209.8%20-12.4%2013.1%20-5.2%203.3%20-10.9%205.8%20-17.1%207.5%20-6.2%201.7%20-12.8%202.6%20-19.6%202.6%20-15.8%200%20-29.3%20-3.1%20-40.7%20-9.2%20-11.4%20-6.1%20-17.1%20-13.4%20-17.1%20-22%200%20-4.2%201.2%20-7.7%203.6%20-10.5%202.4%20-2.8%205.9%20-4.2%2010.6%20-4.2%202.7%200%205.2%200.7%207.6%202.2%202.3%201.5%204.5%203.3%206.4%205.4%202%202.1%204.1%204.2%206.4%206.3%202.3%202.1%205.3%203.9%209.1%205.4%203.8%201.5%208%202.2%2012.8%202.2%206.1%200%2011%20-1.2%2014.7%20-3.6%203.7%20-2.4%205.6%20-5.4%205.6%20-9%200%20-3.7%20-1.5%20-6.5%20-4.5%20-8.4%20-2%20-1.3%20-7.3%20-3%20-15.7%20-5%20L%2089.2%2082.6%20C%2083.6%2081.2%2078.8%2079.7%2074.8%2078%2070.8%2076.3%2067.1%2074%2063.6%2071.2%20c%20-3.4%20-2.8%20-6.1%20-6.3%20-7.8%20-10.6%20-1.8%20-4.2%20-2.7%20-9.2%20-2.7%20-14.9%200%20-6.8%201.6%20-12.8%204.7%20-18%203.1%20-5.2%207.3%20-9.2%2012.4%20-12.2%205.2%20-2.9%2010.7%20-5.1%2016.7%20-6.6%206%20-1.4%2012.1%20-2.2%2018.5%20-2.2%209%200%2017.4%201.1%2025.5%203.2%208%202.1%2014.6%205.3%2019.9%209.4%205.2%204.2%207.8%208.8%207.8%2013.9%200%204.2%20-1.3%207.8%20-4%2010.8%20-2.7%203%20-6.2%204.5%20-10.6%204.5%20-2.4%200%20-4.7%20-0.6%20-6.7%20-1.7%20-2.1%20-1.1%20-3.9%20-2.5%20-5.6%20-4.1%20-1.7%20-1.6%20-3.5%20-3.1%20-5.3%20-4.7%20-1.9%20-1.5%20-4.4%20-2.9%20-7.5%20-4%20-3.2%20-1.1%20-6.8%20-1.7%20-10.8%20-1.7%20-13.4%200%20-20.1%203.6%20-20.1%2010.8%200%201.6%200.4%203%201%204.2%200.7%201.2%201.5%202.2%202.3%202.9%200.8%200.7%202.2%201.5%204.2%202.2%202%200.7%203.6%201.3%204.9%201.6%201.3%200.3%203.4%200.8%206.2%201.5%20l%2014.5%203.4%20c%204.6%201%208.6%202.1%2012.2%203.2%203.6%201.1%207.4%202.7%2011.5%204.8%204.1%202.1%207.5%204.3%2010.2%206.9%202.7%202.5%205%205.7%206.8%209.6%201.8%203.9%202.7%208.1%202.7%2012.8%20-0%206.8%20-1.5%2012.9%20-4.6%2018.4%20z%22%20style%3D%22fill%3A%2300afff%3Bfill-opacity%3A1%22%2F%3E%3C%2Fsvg%3E" />',i='<a href="{href}" style="display: block; padding: 5px;">{type}</a>',o='<div><div style="border-bottom: 1px solid #DDD; color: #AAA; min-width: 100px; padding-bottom: 3px;">{label}:</div>{chatLinks}</div>',s='<a class="{cssClass}" href="javascript:;" id="{id}" data-chatlauncher="{chatLauncher}">{content}</a>',p=e.Component.create({NAME:"chatlauncher",EXTENDS:e.Base,prototype:{EMAIL_SCHEMA:{groupLabelFn:"_emailGroupLabelFn",types:["email"],URIFn:"_emailURIFn"},SKYPE_NUMBER_SCHEMA:{groupLabelFn:"_skypeGroupLabelFn",types:["sms","call"],URIFn:"_skypeURIFn"},SKYPE_SCHEMA:{groupLabelFn:"_skypeGroupLabelFn",types:["chat","call"],URIFn:"_skypeURIFn"},SMS_SCHEMA:{groupLabelFn:"_SMSGroupLabelFn",types:["sms"],URIFn:"_SMSURIFn"},initializer:function(){var t=this;e.Event.defineOutside("touchend"),t._renderTriggerUI(),t._bindTriggerUI()},_adjustLabelCase:function(e){return e="sms"!==e?e.charAt(0).toUpperCase()+e.slice(1):e.toUpperCase()},_bindPopoverUI:function(e){var t=this;e.get("boundingBox").on("mouseleave",t._hidePopoverTask,t)},_bindTriggerUI:function(){var t=this,a=t._triggers,r=n?"tap":"mouseenter";a&&(a.on(r,e.bind(t._syncPopoverHandler,t)),n||a.on("mouseleave",e.bind(t._onLinkMouseLeave,t)))},_clearHideTimeout:function(){var e=this,t=e._hidePopoverTimeout;t&&(t.cancel(),e._hidePopoverTimeout=null)},_emailGroupLabelFn:function(){var e,t=this,a=t._chatLinkData,n=a.html;return n?(e=n,e+=" ("+a.email+")"):e=a.email,e},_emailURIFn:function(){var e=this,t=e._chatLinkData,a=["mailto:"];return a.push(t.email),a.join("")},_getChatLink:function(e){var a=this,n=a._currentSchema,r=a[n.URIFn](e);return t.sub(i,{href:r,type:a._adjustLabelCase(e)})},_getChatLinkGroup:function(e){var a=this,n=[],r=a._setCurrentSchema(e),i=r.types;label=a[r.groupLabelFn]();for(var s=0;s<i.length;s++)n.push(a._getChatLink(i[s]));return t.sub(o,{label:label,chatLinks:n.join("")})},_getLinkData:function(e){var t=this,a={email:e.attr("data-chatemail"),html:e.html(),number:e.attr("data-chatnumber"),topic:e.attr("data-chattopic"),users:e.attr("data-chatlauncher")};return t._chatLinkData=a,a},_getPopover:function(){var t=this;return popover=t._popover,popover||(popover=new e.Popover({align:{points:[e.WidgetPositionAlign.LC,e.WidgetPositionAlign.RC]},constrain:!0,position:"right",zIndex:1}),n||t._bindPopoverUI(popover),t._popover=popover),popover},_getPopoverBodyContent:function(e){{var t=this,a=t._getLinkData(e),r=[];a.topic}return a.users&&r.push(t._getChatLinkGroup("skype")),a.number&&(r.push(t._getChatLinkGroup("skypeNumber")),n&&r.push(t._getChatLinkGroup("sms"))),a.email&&r.push(t._getChatLinkGroup("email")),r.join("")},_getSkypeUserData:function(e){var t,a=this,n=a._chatLinkData;return t=e?n.users:n.number},_hasMultipleParticipants:function(e){return e.match(",")},_hidePopover:function(){var e=this;popover=e._getPopover(),e._clearHideTimeout(),popover.get("boundingBox").test(":hover")||popover.hide()},_hidePopoverTask:function(){var t=this;t._hidePopoverTimeout||(t._hidePopoverTimeout=e.later(300,t,t._hidePopover))},_isSkypeUserName:function(){var e=this,t=e._currentClient;return"skype"===t},_onLinkMouseLeave:function(){var e=this;e._hidePopoverTask()},_renderTriggerUI:function(){var a=this,n=e.all("[data-chatemail], [data-chatlauncher], [data-chatnumber]");n.each(function(r,i){if(a._validateTag(r)){var o={chatLauncher:r.attr("data-chatlauncher"),content:r.html(),cssClass:r.attr("class"),id:r.attr("id")},p=e.Node.create(t.sub(s,o)),u=r.attr("data-chatemail");u&&p.attr("data-chatemail",u);var c=r.attr("data-chatnumber");c&&p.attr("data-chatnumber",c);var h=r.attr("data-chattopic");h&&p.attr("data-chattopic",h),r.replace(p),n._nodes[i]=p}}),a._triggers=n},_setCurrentSchema:function(e){var t,a=this;return"email"===e?t=a.EMAIL_SCHEMA:"skype"===e?t=a.SKYPE_SCHEMA:"skypeNumber"===e?t=a.SKYPE_NUMBER_SCHEMA:"sms"===e&&(t=a.SMS_SCHEMA),a._currentClient=e,a._currentSchema=t,t},_setHideHandler:function(e){var t=this;t._hideHandler||(t._hideHandler=e.get("boundingBox").on("touchendoutside",function(e){var a=e.target;a.hasAttribute("data-chatlauncher")||a.ancestor(".popover",!0,"body")||(t._hidePopover(),t._hideHandler.detach(),t._hideHandler=null)}))},_skypeGroupLabelFn:function(){var e=this,t=e._chatLinkData,a=r+" ",n=e._isSkypeUserName(),i=e._getSkypeUserData(n);if(e._hasMultipleParticipants(i))if(n){var o=t.topic;o=o&&"false"!==o?o:t.html,a+=e._adjustLabelCase(o)}else a+="Phone Numbers";else a+=i;return a},_skypeURIFn:function(e){var t,a=this,n=a._chatLinkData,r=n.topic,i=["skype:"],o=a._getSkypeUserData(a._isSkypeUserName());return a._hasMultipleParticipants(o)&&(o=o.replace(/,/g,";"),"false"!=r&&(t=r)),i.push(o+"?"+e),t&&i.push("&topic="+encodeURI(t)),i.join("")},_SMSGroupLabelFn:function(){return"SMS (Native)"},_SMSURIFn:function(){return"sms:"+this._chatLinkData.number},_syncPopover:function(e){var t=this,a=e.currentTarget,n=t._getPopover(),r=a.guid();if(t._activeTrigger=a,r!=t._activeId){n.set("align.node",a);var i=t._getPopoverBodyContent(a);n.set("bodyContent",i),t._activeId=r,e.halt()}n.get("rendered")?n.show():n.render(),n.align(),t._setHideHandler(n)},_syncPopoverHandler:function(e){var t=this;t._clearHideTimeout(),t._syncPopover(e)},_validateTag:function(e){return-1!==a.indexOf(e.get("nodeName"))}}});new p});